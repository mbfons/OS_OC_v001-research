View(df_input)
df_cleaned <- df_input %>%
mutate(age_group = cut(age,breaks = c(0,18,40,50,60,70,80, Inf),dig.lab = 2),
sex = case_when(sex=="F" ~ "Female",sex=="M" ~ "Male",TRUE ~ sex),
ethnicity = case_when(ethnicity==1 ~ "White",ethnicity==2 ~ "Mixed",ethnicity==3 ~ "Asian",ethnicity==4 ~ "Black",ethnicity==5 ~ "Other")
)
View(df_cleaned)
## open log connection to file
sink(here::here("logs", "log-01-createSDtables.txt"))
## library
library('tidyverse')
library(here)
## import cohort data
df_input <- read_csv(
here::here("output", "input_ori.csv"))
df_cleaned <- df_input %>%
mutate(age_group = cut(age,breaks = c(0,18,40,50,60,70,80, Inf),dig.lab = 2),
sex = case_when(sex=="F" ~ "Female",sex=="M" ~ "Male",TRUE ~ sex),
ethnicity = case_when(ethnicity==1 ~ "White",ethnicity==2 ~ "Mixed",ethnicity==3 ~ "Asian",ethnicity==4 ~ "Black",ethnicity==5 ~ "Other")
)
## close log connection
sink()
tb_gpcr_stp <-
df_cleaned %>%
group_by(region) %>%
summarise(population=n(),gp_consult=sum(gp_consult_count,na.rm=T),rate=gp_consult/population)
View(tb_gpcr_stp)
tb_gpcr_stp <-
df_cleaned %>%
group_by(region) %>%
summarise(
population=n(),
gp_consult=sum(gp_consult_count,na.rm=T),
gp_consult_rate=gp_consult/population,
oc_instance=sum(mock_OC,na.rm=T),
oc_instance_rate=oc_instance/population
)
View(tb_gpcr_stp)
## OC and GP rates per STP
tb02_gpcr_stp <-
df_cleaned %>%
group_by(stp) %>%
summarise(
population=n(),
gp_consult=sum(gp_consult_count,na.rm=T),
gp_consult_rate=gp_consult/population,
oc_instance=sum(mock_OC,na.rm=T),
oc_instance_rate=oc_instance/population
)
View(tb02_gpcr_stp)
df_cleaned <- df_input %>%
mutate(age_group = cut(age,breaks = c(0,18,40,50,60,70,80, Inf),dig.lab = 2),
sex = case_when(sex=="F" ~ "Female",sex=="M" ~ "Male",TRUE ~ sex),
ethnicity = case_when(ethnicity==1 ~ "White",ethnicity==2 ~ "Mixed",ethnicity==3 ~ "Asian",ethnicity==4 ~ "Black",ethnicity==5 ~ "Other"),
gp_consult_had = ifelse(is.na(gp_consult_count)|gp_consult_count==0,0,1)
)
View(df_cleaned)
df_cleaned <- df_input %>%
mutate(age_group = cut(age,breaks = c(0,18,40,50,60,70,80, Inf),dig.lab = 2),
sex = case_when(sex=="F" ~ "Female",sex=="M" ~ "Male",TRUE ~ sex),
ethnicity = case_when(ethnicity==1 ~ "White",ethnicity==2 ~ "Mixed",ethnicity==3 ~ "Asian",ethnicity==4 ~ "Black",ethnicity==5 ~ "Other"),
gp_consult_had = ifelse(is.na(gp_consult_count)|gp_consult_count==0,0,1),
oc_instance_had = ifelse(is.na(mock_OC)|mock_OC==0,0,1)
)
## OC and GP rates per region
tb01_gpcr_stp <-
df_cleaned %>%
group_by(region) %>%
summarise(
population=n(),
gp_consult=sum(gp_consult_count,na.rm=T),
gp_consult_covg = sum(gp_consult_had,na.rm=T),
gp_consult_rate=gp_consult/population,
gp_consult_covg_rate=gp_consult_covg/population,
oc_instance=sum(mock_OC,na.rm=T),
oc_instance_covg=sum(oc_instance_had,na.rm=T),
oc_instance_rate=oc_instance/population,
oc_instance_covg_rate=oc_instance_covg/population
)
## OC and GP rates per region
tb01_gpcr_region <-
df_cleaned %>%
group_by(region) %>%
summarise(
population=n(),
gp_consult=sum(gp_consult_count,na.rm=T),
gp_consult_covg = sum(gp_consult_had,na.rm=T),
gp_consult_rate=gp_consult/population,
gp_consult_covg_rate=gp_consult_covg/population,
oc_instance=sum(mock_OC,na.rm=T),
oc_instance_covg=sum(oc_instance_had,na.rm=T),
oc_instance_rate=oc_instance/population,
oc_instance_covg_rate=oc_instance_covg/population
)
View(tb01_gpcr_region)
## OC and GP rates per practice
tb03_gpcr_practice <-
df_cleaned %>%
group_by(practice) %>%
summarise(
population=n(),
gp_consult=sum(gp_consult_count,na.rm=T),
gp_consult_covg = sum(gp_consult_had,na.rm=T),
gp_consult_rate=gp_consult/population,
gp_consult_covg_rate=gp_consult_covg/population,
oc_instance=sum(mock_OC,na.rm=T),
oc_instance_covg=sum(oc_instance_had,na.rm=T),
oc_instance_rate=oc_instance/population,
oc_instance_covg_rate=oc_instance_covg/population
)
## OC and GP rates per age and gender
tb03_gpcr_agesex <-
df_cleaned %>%
group_by(age_group,sex) %>%
summarise(
population=n(),
gp_consult=sum(gp_consult_count,na.rm=T),
gp_consult_covg = sum(gp_consult_had,na.rm=T),
gp_consult_rate=gp_consult/population,
gp_consult_covg_rate=gp_consult_covg/population,
oc_instance=sum(mock_OC,na.rm=T),
oc_instance_covg=sum(oc_instance_had,na.rm=T),
oc_instance_rate=oc_instance/population,
oc_instance_covg_rate=oc_instance_covg/population
)
## OC and GP rates per age and gender
tb04_gpcr_agesex <-
df_cleaned %>%
group_by(age_group,sex) %>%
summarise(
population=n(),
gp_consult=sum(gp_consult_count,na.rm=T),
gp_consult_covg = sum(gp_consult_had,na.rm=T),
gp_consult_rate=gp_consult/population,
gp_consult_covg_rate=gp_consult_covg/population,
oc_instance=sum(mock_OC,na.rm=T),
oc_instance_covg=sum(oc_instance_had,na.rm=T),
oc_instance_rate=oc_instance/population,
oc_instance_covg_rate=oc_instance_covg/population
)
tb04_gpcr_agesex %>% View()
myvars=region
myvars="region"
## OC and GP rates per region
tb01_gpcr_region <-
df_cleaned %>%
group_by(myvars) %>%
summarise(
population=n(),
gp_consult=sum(gp_consult_count,na.rm=T),
gp_consult_covg = sum(gp_consult_had,na.rm=T),
gp_consult_rate=gp_consult/population,
gp_consult_covg_rate=gp_consult_covg/population,
oc_instance=sum(mock_OC,na.rm=T),
oc_instance_covg=sum(oc_instance_had,na.rm=T),
oc_instance_rate=oc_instance/population,
oc_instance_covg_rate=oc_instance_covg/population
)
## OC and GP rates per region
tb01_gpcr_region <-
df_cleaned %>%
group_by(vars(myvars)) %>%
summarise(
population=n(),
gp_consult=sum(gp_consult_count,na.rm=T),
gp_consult_covg = sum(gp_consult_had,na.rm=T),
gp_consult_rate=gp_consult/population,
gp_consult_covg_rate=gp_consult_covg/population,
oc_instance=sum(mock_OC,na.rm=T),
oc_instance_covg=sum(oc_instance_had,na.rm=T),
oc_instance_rate=oc_instance/population,
oc_instance_covg_rate=oc_instance_covg/population
)
View(tb01_gpcr_region)
## OC and GP rates per region
tb01_gpcr_region <-
df_cleaned %>%
group_by(as.name(myvars)) %>%
summarise(
population=n(),
gp_consult=sum(gp_consult_count,na.rm=T),
gp_consult_covg = sum(gp_consult_had,na.rm=T),
gp_consult_rate=gp_consult/population,
gp_consult_covg_rate=gp_consult_covg/population,
oc_instance=sum(mock_OC,na.rm=T),
oc_instance_covg=sum(oc_instance_had,na.rm=T),
oc_instance_rate=oc_instance/population,
oc_instance_covg_rate=oc_instance_covg/population
)
as.name(myvars)
## OC and GP rates per region
tb01_gpcr_region <-
df_cleaned %>%
group_by_(myvars) %>%
summarise(
population=n(),
gp_consult=sum(gp_consult_count,na.rm=T),
gp_consult_covg = sum(gp_consult_had,na.rm=T),
gp_consult_rate=gp_consult/population,
gp_consult_covg_rate=gp_consult_covg/population,
oc_instance=sum(mock_OC,na.rm=T),
oc_instance_covg=sum(oc_instance_had,na.rm=T),
oc_instance_rate=oc_instance/population,
oc_instance_covg_rate=oc_instance_covg/population
)
## OC and GP rates per region
tb01_gpcr_region <-
df_cleaned %>%
group_by_at(myvars) %>%
summarise(
population=n(),
gp_consult=sum(gp_consult_count,na.rm=T),
gp_consult_covg = sum(gp_consult_had,na.rm=T),
gp_consult_rate=gp_consult/population,
gp_consult_covg_rate=gp_consult_covg/population,
oc_instance=sum(mock_OC,na.rm=T),
oc_instance_covg=sum(oc_instance_had,na.rm=T),
oc_instance_rate=oc_instance/population,
oc_instance_covg_rate=oc_instance_covg/population
)
View(tb01_gpcr_region)
df_to_tbrates <- function(mydf,myvars) {
mytb=
mydf %>%
group_by_at(myvars) %>%
summarise(
population=n(),
gp_consult=sum(gp_consult_count,na.rm=T),
gp_consult_covg = sum(gp_consult_had,na.rm=T),
gp_consult_rate=gp_consult/population,
gp_consult_covg_rate=gp_consult_covg/population,
oc_instance=sum(mock_OC,na.rm=T),
oc_instance_covg=sum(oc_instance_had,na.rm=T),
oc_instance_rate=oc_instance/population,
oc_instance_covg_rate=oc_instance_covg/population
)
return(mytb)
}
## OC and GP rates per region
tb01_gpcr_region <- df_to_tbrates(df_cleaned,c("region"))
## OC and GP rates per region
tb01_gpcr_region %>% view()
## OC and GP rates per STP
tb02_gpcr_stp <- df_to_tbrates(df_cleaned,c("stp"))
## OC and GP rates per STP
tb02_gpcr_stp %>% view()
## OC and GP rates per practice
tb03_gpcr_practice <- df_to_tbrates(df_cleaned,c("practice"))
tb03_gpcr_practice %>% view()
## OC and GP rates per age and gender
tb04_gpcr_agesex <- df_to_tbrates(df_cleaned,c("age_group","sex"))
## OC and GP rates per age and gender
tb04_gpcr_agesex %>% view()
## OC and GP rates by ethnicity
tb05_gpcr_ethnicity <- df_to_tbrates(df_cleaned,c("ethnicity"))
tb05_gpcr_ethnicity %>% view()
## OC and GP rates by region and rurality
tb06_gpcr_ruc <- df_to_tbrates(df_cleaned,c("region","rural_urban"))
tb06_gpcr_ruc %>% view()
## library
library('tidyverse')
library(here)
## import cohort data
df_input <- read_csv(
here::here("output", "input_ori.csv"))
df_cleaned <- df_input %>%
mutate(age_group = cut(age,breaks = c(0,18,40,50,60,70,80, Inf),dig.lab = 2),
sex = case_when(sex=="F" ~ "Female",sex=="M" ~ "Male",TRUE ~ sex),
ethnicity = case_when(ethnicity==1 ~ "White",ethnicity==2 ~ "Mixed",ethnicity==3 ~ "Asian",ethnicity==4 ~ "Black",ethnicity==5 ~ "Other"),
gp_consult_had = ifelse(is.na(gp_consult_count)|gp_consult_count==0,0,1),
oc_instance_had = ifelse(is.na(mock_OC)|mock_OC==0,0,1)
)
df_to_tbrates <- function(mydf,myvars) {
mytb=
mydf %>%
group_by_at(myvars) %>%
summarise(
population=n(),
gp_consult=sum(gp_consult_count,na.rm=T),
gp_consult_covg = sum(gp_consult_had,na.rm=T),
gp_consult_rate=gp_consult/population,
gp_consult_covg_rate=gp_consult_covg/population,
oc_instance=sum(mock_OC,na.rm=T),
oc_instance_covg=sum(oc_instance_had,na.rm=T),
oc_instance_rate=oc_instance/population,
oc_instance_covg_rate=oc_instance_covg/population
)
return(mytb)
}
## OC and GP rates per region
tb01_gpcr_region <- df_to_tbrates(df_cleaned,c("region"))
## OC and GP rates per STP
tb02_gpcr_stp <- df_to_tbrates(df_cleaned,c("stp"))
## OC and GP rates per practice
tb03_gpcr_practice <- df_to_tbrates(df_cleaned,c("practice"))
## OC and GP rates per age and gender
tb04_gpcr_agesex <- df_to_tbrates(df_cleaned,c("age_group","sex"))
## OC and GP rates by ethnicity
tb05_gpcr_ethnicity <- df_to_tbrates(df_cleaned,c("ethnicity"))
## OC and GP rates by care home status
tb06_gpcr_ruc <- df_to_tbrates(df_cleaned,c("care_home_type"))
## OC and GP rates by presence of disability
tb07_gpcr_dis <- df_to_tbrates(df_cleaned,c("has_disability"))
View(tb07_gpcr_dis)
## library
library('tidyverse')
library(here)
## import cohort data
df_input <- read_csv(
here::here("output", "input_ori.csv"))
df_cleaned <- df_input %>%
mutate(age_group = cut(age,breaks = c(0,18,40,50,60,70,80, Inf),dig.lab = 2),
sex = case_when(sex=="F" ~ "Female",sex=="M" ~ "Male",TRUE ~ sex),
ethnicity = case_when(ethnicity==1 ~ "White",ethnicity==2 ~ "Mixed",ethnicity==3 ~ "Asian",ethnicity==4 ~ "Black",ethnicity==5 ~ "Other"),
gp_consult_had = ifelse(is.na(gp_consult_count)|gp_consult_count==0,0,1),
oc_instance_had = ifelse(is.na(OC_instance)|OC_instance==0,0,1),
livingalone = ifelse(hh_size==1,1,0)
)
df_to_tbrates <- function(mydf,myvars,flag_save=0,tb_name="latest") {
mytb=
mydf %>%
group_by_at(myvars) %>%
summarise(
population=n(),
gp_consult=sum(gp_consult_count,na.rm=T),
gp_consult_covg = sum(gp_consult_had,na.rm=T),
gp_consult_rate=gp_consult/population,
gp_consult_covg_rate=gp_consult_covg/population,
oc_instance=sum(OC_instance,na.rm=T),
oc_instance_covg=sum(oc_instance_had,na.rm=T),
oc_instance_rate=oc_instance/population,
oc_instance_covg_rate=oc_instance_covg/population
)
if (flag_save){
write.csv(mytb,paste0(here::here("output","tables"),"/",tb_name,".csv"))
}
return(mytb)
}
## OC and GP rates per region
tb01_gpcr_region <- df_to_tbrates(df_cleaned,c("region"),1,"tb01_gpcr_region")
## OC and GP rates per STP
tb02_gpcr_stp <- df_to_tbrates(df_cleaned,c("stp"),1,"tb02_gpcr_stp")
## OC and GP rates per practice
tb03_gpcr_practice <- df_to_tbrates(df_cleaned,c("practice"),1,"tb03_gpcr_practice")
## OC and GP rates per age and gender
tb04_gpcr_agesex <- df_to_tbrates(df_cleaned,c("age_group","sex"),1,"tb04_gpcr_agesex")
## OC and GP rates by ethnicity
tb05_gpcr_ethnicity <- df_to_tbrates(df_cleaned,c("ethnicity"),1,"tb05_gpcr_ethnicity")
## OC and GP rates by region and rurality
tb06_gpcr_care <- df_to_tbrates(df_cleaned,c("region","rural_urban"),1,"tb06_gpcr_ruc")
## OC and GP rates by care home status
tb07_gpcr_care <- df_to_tbrates(df_cleaned,c("care_home_type"),1,"tb07_gpcr_care")
## OC and GP rates by presence of disability
tb08_gpcr_dis <- df_to_tbrates(df_cleaned,c("has_disability"),1,"tb08_gpcr_dis")
View(tb08_gpcr_dis)
View(df_cleaned)
install.packages("gtsummary")
library(gtsummary)
df_cleaned %>% tbl_summary()
## Characteristics of those with any OC consultation, any GP consultation and overall population
desc_vars=c("sex","latest_consultation_date")
df_cleaned %>% select(desc_vars) %>% tbl_summary()
df_cleaned %>% tbl_summary()
df_cleaned <- df_input %>%
mutate(age_group = cut(age,breaks = c(0,18,40,50,60,70,80, Inf),dig.lab = 2),
sex = case_when(sex=="F" ~ "Female",sex=="M" ~ "Male",TRUE ~ sex),
ethnicity = case_when(ethnicity==1 ~ "White",ethnicity==2 ~ "Mixed",ethnicity==3 ~ "Asian",ethnicity==4 ~ "Black",ethnicity==5 ~ "Other"),
gp_consult_had = ifelse(is.na(gp_consult_count)|gp_consult_count==0,0,1),
oc_instance_had = ifelse(is.na(OC_instance)|OC_instance==0,0,1),
livingalone = ifelse(hh_size==1,1,0),
has_disability = ifelse(is.na(has_disability),0,has_disability)
)
## Characteristics of those with any OC consultation, any GP consultation and overall population
desc_vars=c("sex","age","age_group","ethnicity","livingalone","region","rural_urban","care_home_type","latest_consultation_date")
df_cleaned %>% select(desc_vars) %>% tbl_summary()
df_cleaned %>% select(desc_vars) %>% tbl_summary() %>% add_n()
df_cleaned %>% select(desc_vars) %>% tbl_summary(by=oc_instance_had)
## Characteristics of those with any OC consultation, any GP consultation and overall population
desc_vars=c("sex","age","age_group","ethnicity","livingalone","region","rural_urban","care_home_type","latest_consultation_date","oc_instance_had")
df_cleaned %>% select(desc_vars) %>% tbl_summary(by=oc_instance_had)
df_cleaned %>% select(desc_vars) %>% tbl_summary(by=oc_instance_had) %>% modify_header(label="**Variable \ Had_OC**")
df_cleaned %>% select(desc_vars) %>% tbl_summary(by=oc_instance_had) %>% modify_header(label="**Characteristic | had OC**")
df_cleaned %>% select(desc_vars) %>% tbl_summary(by=oc_instance_had) %>% add_p() %>% modify_header(label="**Characteristic | had OC**")
df_cleaned <- df_input %>%
mutate(age_group = cut(age,breaks = c(0,18,40,50,60,70,80, Inf),dig.lab = 2),
sex = case_when(sex=="F" ~ "Female",sex=="M" ~ "Male",TRUE ~ sex),
ethnicity = case_when(ethnicity==1 ~ "White",ethnicity==2 ~ "Mixed",ethnicity==3 ~ "Asian",ethnicity==4 ~ "Black",ethnicity==5 ~ "Other"),
gp_consult_had = ifelse(is.na(gp_consult_count)|gp_consult_count==0,0,1),
oc_instance_had = ifelse(is.na(OC_instance)|OC_instance==0,0,1),
livingalone = ifelse(hh_size<=4,1,0),
has_disability = ifelse(is.na(has_disability),0,has_disability)
)
df_cleaned %>% select(desc_vars) %>% tbl_summary(by=oc_instance_had) %>% add_p() %>% modify_header(label="**Characteristic | had OC**")
## Characteristics of those with any OC consultation, any GP consultation and overall population
desc_vars=c("sex","age","age_group","ethnicity","livingalone","region","rural_urban","care_home_type","oc_instance_had")
df_cleaned %>% tbl_summary()
df_cleaned %>% select(desc_vars) %>% tbl_summary(by=oc_instance_had) %>% add_p() %>% modify_header(label="**Characteristic | had OC**")
df_cleaned %>% select(desc_vars) %>% tbl_summary(by=gp_instance_had) %>% add_p() %>% modify_header(label="**Characteristic | had GP consultation**")
desc_vars2=c("sex","age","age_group","ethnicity","livingalone","region","rural_urban","care_home_type","gp_consult_had")
df_cleaned %>% select(desc_vars) %>% tbl_summary(by=gp_consult_had) %>% add_p() %>% modify_header(label="**Characteristic | had GP consultation**")
df_cleaned %>% select(desc_vars2) %>% tbl_summary(by=gp_consult_had) %>% add_p() %>% modify_header(label="**Characteristic | had GP consultation**")
df_cleaned %>% select(desc_vars) %>% tbl_summary(by=oc_instance_had) %>% add_p() %>% add_overall() %>% modify_header(label="**Characteristic | had OC**")
df_cleaned %>% select(desc_vars2) %>% tbl_summary(by=gp_consult_had) %>% add_p() %>% add_overall() %>% modify_header(label="**Characteristic | had GP consultation**")
gt_ocpop <- df_cleaned %>% select(desc_vars) %>% tbl_summary(by=oc_instance_had) %>% add_p() %>% add_overall() %>% modify_header(label="**Characteristic | had OC**")
tempdir()
?file.patj
?file.path
here::here("output","tables")
file.path(tempdir(), "temp.png")
# Use function from gt package to save table
gt::gtsave(gt_ocpop, file = file.path(here::here("output","tables"), "gt_ocpop.png"))
# Use function from gt package to save table
gt::gtsave(as_gt(gt_ocpop), file = file.path(here::here("output","tables"), "gt_ocpop.png"))
install.packages("gt")
## library
library(tidyverse)
library(gtsummary)
library(gt)
library(here)
## import and pre-process cohort data
df_input <- read_csv(
here::here("output", "input_ori.csv"))
df_cleaned <- df_input %>%
mutate(age_group = cut(age,breaks = c(0,18,40,50,60,70,80, Inf),dig.lab = 2),
sex = case_when(sex=="F" ~ "Female",sex=="M" ~ "Male",TRUE ~ sex),
ethnicity = case_when(ethnicity==1 ~ "White",ethnicity==2 ~ "Mixed",ethnicity==3 ~ "Asian",ethnicity==4 ~ "Black",ethnicity==5 ~ "Other"),
gp_consult_had = ifelse(is.na(gp_consult_count)|gp_consult_count==0,0,1),
oc_instance_had = ifelse(is.na(OC_instance)|OC_instance==0,0,1),
livingalone = ifelse(hh_size<=4,1,0),
has_disability = ifelse(is.na(has_disability),0,has_disability)
)
## Characteristics of those with any OC consultation, any GP consultation and overall population
desc_vars=c("sex","age","age_group","ethnicity","livingalone","region","rural_urban","care_home_type","oc_instance_had")
df_cleaned %>% tbl_summary()
gt_ocpop <- df_cleaned %>% select(desc_vars) %>% tbl_summary(by=oc_instance_had) %>% add_p() %>% add_overall() %>% modify_header(label="**Characteristic | had OC**")
desc_vars2=c("sex","age","age_group","ethnicity","livingalone","region","rural_urban","care_home_type","gp_consult_had")
df_cleaned %>% select(desc_vars2) %>% tbl_summary(by=gp_consult_had) %>% add_p() %>% add_overall() %>% modify_header(label="**Characteristic | had GP consultation**")
# Use function from gt package to save table
gt::gtsave(as_gt(gt_ocpop), file = file.path(here::here("output","tables"), "gt_ocpop.png"))
install.packages("webshot")
library(webshot)
# Use function from gt package to save table
gt::gtsave(as_gt(gt_ocpop), file = file.path(here::here("output","tables"), "gt_ocpop.png"))
webshot::install_phantomjs()
# Use function from gt package to save table
gt::gtsave(as_gt(gt_ocpop), file = file.path(here::here("output","tables"), "gt_ocpop.png"))
gt_gpcpop <- df_cleaned %>% select(desc_vars2) %>% tbl_summary(by=gp_consult_had) %>% add_p() %>% add_overall() %>% modify_header(label="**Characteristic | had GP consultation**")
gt::gtsave(as_gt(gt_gpcpop), file = file.path(here::here("output","tables"), "gt_ocpop.png"))
# Use function from gt package to save table
gt::gtsave(as_gt(gt_ocpop), file = file.path(here::here("output","tables"), "gt_ocpop.png"))
gt::gtsave(as_gt(gt_gpcpop), file = file.path(here::here("output","tables"), "gt_gpcpop.png"))
as.gt(tb01_gpcr_stp)
gt::as.gt(tb01_gpcr_stp)
as_gt(tb01_gpcr_stp)
as_gt(tb02_gpcr_stp)
df_cleaned <- df_input %>%
mutate(age_group = factor(cut(age,breaks = c(0,18,40,50,60,70,80, Inf),dig.lab = 2)),
sex = case_when(sex=="F" ~ "Female",sex=="M" ~ "Male",TRUE ~ sex),
ethnicity = case_when(ethnicity==1 ~ "White",ethnicity==2 ~ "Mixed",ethnicity==3 ~ "Asian",ethnicity==4 ~ "Black",ethnicity==5 ~ "Other"),
gp_consult_had = ifelse(is.na(gp_consult_count)|gp_consult_count==0,0,1),
oc_instance_had = ifelse(is.na(OC_instance)|OC_instance==0,0,1),
livingalone = ifelse(hh_size<=4,1,0),
has_disability = ifelse(is.na(has_disability),0,has_disability)
)
df_cleaned <- df_input %>%
mutate(age_group = factor(cut(age,breaks = c(0,18,40,50,60,70,80, Inf),dig.lab = 2)),
sex = factor(case_when(sex=="F" ~ "Female",sex=="M" ~ "Male",TRUE ~ sex)),
ethnicity = factor(case_when(ethnicity==1 ~ "White",ethnicity==2 ~ "Mixed",ethnicity==3 ~ "Asian",ethnicity==4 ~ "Black",ethnicity==5 ~ "Other")),
care_home_type=factor(care_home_type),
gp_consult_had = ifelse(is.na(gp_consult_count)|gp_consult_count==0,0,1),
oc_instance_had = ifelse(is.na(OC_instance)|OC_instance==0,0,1),
livingalone = ifelse(hh_size<=4,1,0),
has_disability = ifelse(is.na(has_disability),0,has_disability)
)
## OC and GP rates per age and gender
tb04_gpcr_agesex <- df_to_tbrates(df_cleaned,c("age_group","sex"),1,"tb04_gpcr_agesex")
tb04_gpcr_agesex %>% view()
gt_ocpop <- df_cleaned %>% select(desc_vars) %>% tbl_summary(by=oc_instance_had) %>% add_p() %>% add_overall() %>% modify_header(label="**Characteristic | had OC**") %>%
modify_spanning_header(c("stat_1", "stat_2") ~ "**Treatment Received**")
gt_ocpop <- df_cleaned %>% select(desc_vars) %>% tbl_summary(by=oc_instance_had) %>% add_p() %>% add_overall() %>% modify_header(label="**Characteristic | had OC**") %>%
modify_spanning_header(c("0", "1") ~ "**Treatment Received**")
gt_ocpop <- df_cleaned %>% select(desc_vars) %>% tbl_summary(by=oc_instance_had) %>% add_p() %>% add_overall() %>% modify_header(label="**Characteristic | had OC**") %>%
modify_spanning_header(c("stat_1", "stat_2") ~ "**Treatment Received**")
gt_ocpop <-
df_cleaned %>% select(desc_vars) %>% tbl_summary(by=oc_instance_had) %>% add_p() %>% add_overall() %>% modify_header(label="**Characteristic | had OC**") %>%
modify_spanning_header(c("stat_1", "stat_2") ~ "**Treatment Received**")
gt_ocpop <-
df_cleaned %>% select(desc_vars) %>% tbl_summary(by=oc_instance_had) %>% add_p() %>% add_overall() %>% modify_header(label="**Characteristic | had OC**") %>%
modify_spanning_header(c("stat_1", "stat_2") ~ "**Treatment Received**")
gt_ocpop <-
df_cleaned %>% select(desc_vars) %>% tbl_summary(by=oc_instance_had) %>% add_p() %>% add_overall() %>% modify_header(label="**Characteristic | had OC**")
gt_gpcpop <- df_cleaned %>% select(desc_vars2) %>% tbl_summary(by=gp_consult_had) %>% add_p() %>% add_overall() %>% modify_header(label="**Characteristic | had GP consultation**")
## Characteristics of those with any OC consultation, any GP consultation and overall population
desc_vars=c("sex","age","age_group","ethnicity","livingalone","region","rural_urban","care_home_type","oc_instance_had")
gt_ocpop <-
df_cleaned %>% select(desc_vars) %>% tbl_summary(by=oc_instance_had) %>% add_p() %>% add_overall() %>% modify_header(label="**Characteristic | had OC**")
df_cleaned %>% select(desc_vars) %>% tbl_summary(by=oc_instance_had) %>% add_p() %>% add_overall() %>% modify_header(label="**Characteristic | had OC**")
df_cleaned %>% select(desc_vars) %>% tbl_summary(by=oc_instance_had) %>% add_p() %>% add_overall() %>% modify_header(label="**Characteristic | had OC**") modify_spanning_header(c("stat_1", "stat_2") ~ "**Had any OC instance**")
df_cleaned %>% select(desc_vars) %>% tbl_summary(by=oc_instance_had) %>% add_p() %>% add_overall() %>% modify_header(label="**Characteristic | had OC**") %>% modify_spanning_header(c("stat_1", "stat_2") ~ "**Had any OC instance**")
df_cleaned %>% select(desc_vars) %>% tbl_summary(by=oc_instance_had) %>% add_p() %>% add_overall() %>% modify_header(label="**Characteristic | had OC**") %>% modify_spanning_header(c("stat_1", "stat_2") ~ "**Had any OC instance**")
gt_ocpop <- df_cleaned %>% select(desc_vars) %>% tbl_summary(by=oc_instance_had) %>% add_p() %>% add_overall() %>% modify_header(label="**Characteristic | had OC**") %>% modify_spanning_header(c("stat_1", "stat_2") ~ "**Had any OC instance**")
View(gt_ocpop)
as.gt(gt_ocpop)
as_gt(gt_ocpop)
as_gt(gt_ocpop)
?save
# Save dta with actual table data
save(gt_ocpop,file = file.path(here::here("output","tables"), "gt_ocpop.RData"))
(gt_ocpop <- df_cleaned %>% select(desc_vars) %>% tbl_summary(by=oc_instance_had) %>% add_p() %>% add_overall() %>% modify_header(label="**Characteristic | had OC**") %>% modify_spanning_header(c("stat_1", "stat_2") ~ "**Had any OC instance**"))
(gt_gpcpop <- df_cleaned %>% select(desc_vars2) %>% tbl_summary(by=gp_consult_had) %>% add_p() %>% add_overall() %>% modify_header(label="**Characteristic | had GP consultation**") %>% modify_spanning_header(c("stat_1", "stat_2") ~ "**Had any GP consultation**"))
(gt_gpcpop <- df_cleaned %>% select(desc_vars2) %>% tbl_summary(by=gp_consult_had) %>% add_p() %>% add_overall() %>% modify_header(label="**Characteristic | had GP consultation**") %>% modify_spanning_header(c("stat_1", "stat_2") ~ "**Had any GP consultation**"))
save(gt_gpcpop,file = file.path(here::here("output","tables"), "gt_gpcpop.RData"))
